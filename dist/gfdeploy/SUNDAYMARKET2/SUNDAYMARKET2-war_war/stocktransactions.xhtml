<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets"
      xmlns:pt="jakarta.faces.passthrough">
    
    <ui:composition template="/template/template.xhtml">
        <ui:define name="title">üì¶ Stock Management</ui:define>
        
        <ui:define name="content">
            <h:messages id="messages" globalOnly="true" styleClass="alert alert-info" />
            
            <!-- Header -->
            <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 25px;">
                <h2 style="margin: 0; color: #2c3e50;">üì¶ Stock Management</h2>
                <h:form id="headerForm">
                    <h:commandButton value="‚ûï Import/Export Stock" actionListener="#{stockTransactionsMBean.prepareCreate}"
                                    style="background: linear-gradient(135deg, #28a745, #20c997); border: none; padding: 12px 24px; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                        <f:ajax render=":transactionForm:transactionFormModal :stockForm :historyForm"
                                onevent="function(data){if(data.status=='success'){showModal('transactionModalOverlay');}}" />
                    </h:commandButton>
                </h:form>
            </div>
            
            <!-- STOCK STATISTICS -->
            <h:form id="statsForm">
                <h:panelGroup id="statsWrapper">
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px;">
                        <div style="background: linear-gradient(135deg, #3f72af, #5a95cf); padding: 20px; border-radius: 12px; color: white;">
                            <div style="font-size: 14px; opacity: 0.9;">üìä Total Stock Quantity</div>
                            <div style="font-size: 28px; font-weight: 700; margin-top: 5px;">#{stockTransactionsMBean.totalStockQuantity}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #28a745, #20c997); padding: 20px; border-radius: 12px; color: white;">
                            <div style="font-size: 14px; opacity: 0.9;">üì¶ Total Products</div>
                            <div style="font-size: 28px; font-weight: 700; margin-top: 5px;">#{stockTransactionsMBean.totalProducts}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #ffc107, #ffca2c); padding: 20px; border-radius: 12px; color: #333;">
                            <div style="font-size: 14px; opacity: 0.9;">‚ö†Ô∏è Low Stock</div>
                            <div style="font-size: 28px; font-weight: 700; margin-top: 5px;">#{stockTransactionsMBean.lowStockCount}</div>
                        </div>
                        <div style="background: linear-gradient(135deg, #dc3545, #e4606d); padding: 20px; border-radius: 12px; color: white;">
                            <div style="font-size: 14px; opacity: 0.9;">‚ùå Out of Stock</div>
                            <div style="font-size: 28px; font-weight: 700; margin-top: 5px;">#{stockTransactionsMBean.outOfStockCount}</div>
                        </div>
                    </div>
                </h:panelGroup>
            </h:form>
            
            <!-- ========== SEARCH SECTION ========== -->
            <div class="search-section" style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);">
                <h:form id="stockSearchForm">
                    <div style="display: flex; gap: 12px; align-items: center; flex-wrap: nowrap;">
                        <div style="flex: 1; min-width: 0; position: relative; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h:inputText id="stockSearch" 
                                       value="#{stockTransactionsMBean.stockSearchKeyword}"
                                       styleClass="form-control search-input"
                                       style="width: 100%; padding: 14px 50px 14px 14px; border: none; border-radius: 12px; font-size: 15px; outline: none; background: transparent;">
                                <f:passThroughAttribute name="placeholder" value="üîç T√¨m ki·∫øm theo t√™n s·∫£n ph·∫©m..." />
                                <f:ajax event="keyup" delay="300" listener="#{stockTransactionsMBean.searchStock}" render="stockWrapper stockPaginationInfo" />
                            </h:inputText>
                            <h:commandButton value="‚úï" 
                                           actionListener="#{stockTransactionsMBean.clearStockSearch()}"
                                           rendered="#{not empty stockTransactionsMBean.stockSearchKeyword}"
                                           styleClass="btn-clear-search"
                                           style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 32px; height: 32px; padding: 0; background: #f0f0f0; border: none; color: #999; font-size: 16px; cursor: pointer; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s; font-weight: bold;"
                                           title="X√≥a t√¨m ki·∫øm"
                                           onmouseover="this.style.background='#e0e0e0'; this.style.color='#666';"
                                           onmouseout="this.style.background='#f0f0f0'; this.style.color='#999';">
                                <f:ajax render="stockSearchForm stockWrapper stockPaginationInfo" />
                            </h:commandButton>
                        </div>
                        <h:commandButton value="üîç T√¨m ki·∫øm" 
                                       actionListener="#{stockTransactionsMBean.searchStock}"
                                       styleClass="btn-search-modern"
                                       style="padding: 14px 28px; font-size: 15px; font-weight: 600; border-radius: 12px; border: none; background: white; color: #667eea; box-shadow: 0 4px 12px rgba(255,255,255,0.3); transition: all 0.3s; cursor: pointer; white-space: nowrap; flex-shrink: 0;"
                                       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(255,255,255,0.4)';"
                                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(255,255,255,0.3)';">
                            <f:ajax render="stockWrapper stockPaginationInfo" />
                        </h:commandButton>
                    </div>
                </h:form>
            </div>
            
            <!-- PRODUCT STOCK TABLE -->
            <h:form id="stockForm">
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1); margin-bottom: 30px;">
                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; border-bottom: 2px solid #3f72af; padding-bottom: 10px;">
                        üìã Product Stock
                    </h3>
                    
                    <div style="display: flex; gap: 15px; align-items: center; margin-bottom: 20px; flex-wrap: wrap;">
                        <h:commandButton value="‚öôÔ∏è Set Default Min Stock" 
                                        actionListener="#{stockTransactionsMBean.initAllMinStock}"
                                        style="padding: 10px 15px; border: none; background: #6c757d; color: white; border-radius: 8px; cursor: pointer; font-size: 13px;">
                            <f:ajax execute="@form" render="stockWrapper :statsForm:statsWrapper :messages" />
                        </h:commandButton>
                    </div>
                    
                    <h:panelGroup id="stockWrapper">
                        <h:dataTable value="#{stockTransactionsMBean.pagedProductsWithStock}" var="product" 
                                    styleClass="table table-striped" style="width: 100%;"
                                    rendered="#{not empty stockTransactionsMBean.pagedProductsWithStock}">
                            
                            <h:column>
                                <f:facet name="header">ID</f:facet>
                                #{product.productID}
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Product</f:facet>
                                #{product.name}
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Brand</f:facet>
                                #{product.brandID.brandName}
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Category</f:facet>
                                #{product.categoryID.categoryName}
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Stock Quantity</f:facet>
                                <h:outputText value="#{product.quantity}" style="font-weight: 700; font-size: 16px; color: #{stockTransactionsMBean.getStockStatusColor(product)};" />
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Min Stock</f:facet>
                                <div style="display: flex; align-items: center; gap: 5px;">
                                    <h:inputText value="#{product.minStock}" 
                                                pt:placeholder="10"
                                                style="width: 60px; padding: 5px; text-align: center; border: 1px solid #ddd; border-radius: 4px;" />
                                    <h:commandButton value="üíæ" title="Save min stock"
                                                    style="padding: 5px 8px; border: none; background: #28a745; color: white; border-radius: 4px; cursor: pointer;"
                                                    actionListener="#{stockTransactionsMBean.saveMinStock(product)}">
                                        <f:ajax execute="@form" render=":stockForm:stockWrapper :statsForm:statsWrapper :messages" />
                                    </h:commandButton>
                                </div>
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Status</f:facet>
                                <h:outputText value="#{stockTransactionsMBean.getStockStatus(product)}" 
                                             style="color: #{stockTransactionsMBean.getStockStatusColor(product)}; font-weight: 600;" />
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Price</f:facet>
                                #{stockTransactionsMBean.formatCurrency(product.unitPrice)}
                            </h:column>
                        </h:dataTable>
                        
                        <h:outputText value="üì≠ No products found" rendered="#{empty stockTransactionsMBean.pagedProductsWithStock}"
                                     style="display: block; text-align: center; padding: 30px; color: #666;" />
                        
                        <!-- ===== PH√ÇN TRANG ===== -->
                        <div class="pagination-container" id="stockPaginationInfo" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: block; width: 100%;">
                            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                                <h:outputText value="Page #{stockTransactionsMBean.stockCurrentPage} / #{stockTransactionsMBean.stockTotalPages} (Total: #{stockTransactionsMBean.stockTotalItems} products)" 
                                             styleClass="pagination-info" 
                                             style="font-weight: 500; color: #333; font-size: 14px;" />
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <h:commandButton value="‚èÆÔ∏è First" actionListener="#{stockTransactionsMBean.stockFirstPage()}" 
                                                   styleClass="btn btn-secondary" 
                                                   disabled="#{stockTransactionsMBean.stockCurrentPage == 1 or stockTransactionsMBean.stockTotalPages le 1}"
                                                   style="min-width: 100px;">
                                        <f:ajax render="stockWrapper stockPaginationInfo" />
                                    </h:commandButton>
                                    <h:commandButton value="‚óÄÔ∏è Prev" actionListener="#{stockTransactionsMBean.stockPreviousPage()}" 
                                                   styleClass="btn btn-secondary" 
                                                   disabled="#{stockTransactionsMBean.stockCurrentPage == 1 or stockTransactionsMBean.stockTotalPages le 1}"
                                                   style="min-width: 80px;">
                                        <f:ajax render="stockWrapper stockPaginationInfo" />
                                    </h:commandButton>
                                    <h:commandButton value="Next ‚ñ∂Ô∏è" actionListener="#{stockTransactionsMBean.stockNextPage()}" 
                                                   styleClass="btn btn-secondary" 
                                                   disabled="#{stockTransactionsMBean.stockCurrentPage == stockTransactionsMBean.stockTotalPages or stockTransactionsMBean.stockTotalPages le 1}"
                                                   style="min-width: 80px;">
                                        <f:ajax render="stockWrapper stockPaginationInfo" />
                                    </h:commandButton>
                                    <h:commandButton value="Last ‚è≠Ô∏è" actionListener="#{stockTransactionsMBean.stockLastPage()}" 
                                                   styleClass="btn btn-secondary" 
                                                   disabled="#{stockTransactionsMBean.stockCurrentPage == stockTransactionsMBean.stockTotalPages or stockTransactionsMBean.stockTotalPages le 1}"
                                                   style="min-width: 100px;">
                                        <f:ajax render="stockWrapper stockPaginationInfo" />
                                    </h:commandButton>
                                </div>
                            </div>
                        </div>
                    </h:panelGroup>
                </div>
            </h:form>
            
            <!-- IMPORT/EXPORT HISTORY -->
            <!-- ========== HISTORY SEARCH SECTION ========== -->
            <div class="search-section" style="margin: 20px 0; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: 16px; box-shadow: 0 4px 20px rgba(102, 126, 234, 0.3);">
                <h:form id="historySearchForm">
                    <div style="display: flex; gap: 12px; align-items: center; flex-wrap: nowrap;">
                        <div style="flex: 1; min-width: 0; position: relative; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                            <h:inputText id="historySearch" 
                                       value="#{stockTransactionsMBean.historySearchKeyword}"
                                       styleClass="form-control search-input"
                                       style="width: 100%; padding: 14px 50px 14px 14px; border: none; border-radius: 12px; font-size: 15px; outline: none; background: transparent;">
                                <f:passThroughAttribute name="placeholder" value="üîç T√¨m ki·∫øm theo t√™n s·∫£n ph·∫©m..." />
                                <f:ajax event="keyup" delay="300" listener="#{stockTransactionsMBean.searchHistory()}" render="historyWrapper historyPaginationInfo" />
                            </h:inputText>
                            <h:commandButton value="‚úï" 
                                           actionListener="#{stockTransactionsMBean.clearHistorySearch()}"
                                           rendered="#{not empty stockTransactionsMBean.historySearchKeyword}"
                                           styleClass="btn-clear-search"
                                           style="position: absolute; right: 8px; top: 50%; transform: translateY(-50%); width: 32px; height: 32px; padding: 0; background: #f0f0f0; border: none; color: #999; font-size: 16px; cursor: pointer; border-radius: 50%; display: flex; align-items: center; justify-content: center; transition: all 0.3s; font-weight: bold;"
                                           title="X√≥a t√¨m ki·∫øm"
                                           onmouseover="this.style.background='#e0e0e0'; this.style.color='#666';"
                                           onmouseout="this.style.background='#f0f0f0'; this.style.color='#999';">
                                <f:ajax render="historySearchForm historyWrapper historyPaginationInfo" />
                            </h:commandButton>
                        </div>
                        <h:selectOneMenu id="historyFilter" 
                                       value="#{stockTransactionsMBean.historyFilterType}"
                                       styleClass="form-select"
                                       style="min-width: 150px; padding: 14px; border-radius: 12px; border: none; background: white; font-size: 15px; outline: none; box-shadow: 0 2px 8px rgba(0,0,0,0.1); cursor: pointer; flex-shrink: 0;">
                            <f:selectItem itemLabel="üìã T·∫•t c·∫£" itemValue="" />
                            <f:selectItem itemLabel="üì• Import" itemValue="Import" />
                            <f:selectItem itemLabel="üì§ Export" itemValue="Export" />
                            <f:ajax event="change" listener="#{stockTransactionsMBean.searchHistory()}" render="historyWrapper historyPaginationInfo" />
                        </h:selectOneMenu>
                        <h:commandButton value="üîç T√¨m ki·∫øm" 
                                       actionListener="#{stockTransactionsMBean.searchHistory()}"
                                       styleClass="btn-search-modern"
                                       style="padding: 14px 28px; font-size: 15px; font-weight: 600; border-radius: 12px; border: none; background: white; color: #667eea; box-shadow: 0 4px 12px rgba(255,255,255,0.3); transition: all 0.3s; cursor: pointer; white-space: nowrap; flex-shrink: 0;"
                                       onmouseover="this.style.transform='translateY(-2px)'; this.style.boxShadow='0 6px 16px rgba(255,255,255,0.4)';"
                                       onmouseout="this.style.transform='translateY(0)'; this.style.boxShadow='0 4px 12px rgba(255,255,255,0.3)';">
                            <f:ajax render="historyWrapper historyPaginationInfo" />
                        </h:commandButton>
                    </div>
                </h:form>
            </div>
            
            <h:form id="historyForm">
                <div style="background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 10px rgba(0,0,0,0.1);">
                    <h3 style="margin: 0 0 20px 0; color: #2c3e50; border-bottom: 2px solid #3f72af; padding-bottom: 10px;">
                        üìú Import/Export History
                    </h3>
                    
                    <h:panelGroup id="historyWrapper">
                        <h:dataTable value="#{stockTransactionsMBean.pagedTransactionHistory}" var="trans" 
                                    styleClass="table table-striped" style="width: 100%;"
                                    rendered="#{not empty stockTransactionsMBean.pagedTransactionHistory}">
                            
                            <h:column>
                                <f:facet name="header">ID</f:facet>
                                #{stockTransactionsMBean.formatID(trans.transactionID)}
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Type</f:facet>
                                <h:outputText value="#{stockTransactionsMBean.getTypeText(trans.type)}"
                                             style="color: #{stockTransactionsMBean.getTypeColor(trans.type)}; font-weight: 600;" />
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Product</f:facet>
                                #{trans.productID.name}
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Quantity</f:facet>
                                <h:outputText value="#{trans.type == 'Import' ? '+' : '-'}#{trans.quantity}"
                                             style="font-weight: 700; color: #{trans.type == 'Import' ? '#28a745' : '#dc3545'};" />
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Unit Cost</f:facet>
                                <h:outputText value="#{stockTransactionsMBean.formatCurrency(trans.unitCost)}"
                                             rendered="#{trans.unitCost != null}" />
                                <h:outputText value="-" rendered="#{trans.unitCost == null}" />
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Supplier</f:facet>
                                #{trans.supplierID != null ? trans.supplierID.supplierName : '-'}
                            </h:column>
                            
                            <h:column>
                                <f:facet name="header">Date</f:facet>
                                #{stockTransactionsMBean.formatDate(trans.createdAt)}
                            </h:column>
                        </h:dataTable>
                        
                        <h:outputText value="üì≠ No transactions found" rendered="#{empty stockTransactionsMBean.pagedTransactionHistory}"
                                     style="display: block; text-align: center; padding: 30px; color: #666;" />
                        
                        <!-- ===== PH√ÇN TRANG HISTORY ===== -->
                        <div class="pagination-container" id="historyPaginationInfo" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px; display: block; width: 100%;">
                            <div style="display: flex; align-items: center; justify-content: space-between; flex-wrap: wrap; gap: 15px;">
                                <h:outputText value="Page #{stockTransactionsMBean.historyCurrentPage} / #{stockTransactionsMBean.historyTotalPages} (Total: #{stockTransactionsMBean.historyTotalItems} transactions)" 
                                             styleClass="pagination-info" 
                                             style="font-weight: 500; color: #333; font-size: 14px;" />
                                <div style="display: flex; gap: 8px; flex-wrap: wrap;">
                                    <h:commandButton value="‚èÆÔ∏è First" actionListener="#{stockTransactionsMBean.historyFirstPage()}" 
                                                   styleClass="btn btn-secondary" 
                                                   disabled="#{stockTransactionsMBean.historyCurrentPage == 1 or stockTransactionsMBean.historyTotalPages le 1}"
                                                   style="min-width: 100px;">
                                        <f:ajax render="historyWrapper historyPaginationInfo" />
                                    </h:commandButton>
                                    <h:commandButton value="‚óÄÔ∏è Prev" actionListener="#{stockTransactionsMBean.historyPreviousPage()}" 
                                                   styleClass="btn btn-secondary" 
                                                   disabled="#{stockTransactionsMBean.historyCurrentPage == 1 or stockTransactionsMBean.historyTotalPages le 1}"
                                                   style="min-width: 80px;">
                                        <f:ajax render="historyWrapper historyPaginationInfo" />
                                    </h:commandButton>
                                    <h:commandButton value="Next ‚ñ∂Ô∏è" actionListener="#{stockTransactionsMBean.historyNextPage()}" 
                                                   styleClass="btn btn-secondary" 
                                                   disabled="#{stockTransactionsMBean.historyCurrentPage == stockTransactionsMBean.historyTotalPages or stockTransactionsMBean.historyTotalPages le 1}"
                                                   style="min-width: 80px;">
                                        <f:ajax render="historyWrapper historyPaginationInfo" />
                                    </h:commandButton>
                                    <h:commandButton value="Last ‚è≠Ô∏è" actionListener="#{stockTransactionsMBean.historyLastPage()}" 
                                                   styleClass="btn btn-secondary" 
                                                   disabled="#{stockTransactionsMBean.historyCurrentPage == stockTransactionsMBean.historyTotalPages or stockTransactionsMBean.historyTotalPages le 1}"
                                                   style="min-width: 100px;">
                                        <f:ajax render="historyWrapper historyPaginationInfo" />
                                    </h:commandButton>
                                </div>
                            </div>
                        </div>
                    </h:panelGroup>
                </div>
            </h:form>
            
            <!-- ADD TRANSACTION MODAL -->
            <h:form id="transactionForm">
                <h:panelGroup id="transactionFormModal">
                    <div id="transactionModalOverlay"
                         style="display: #{stockTransactionsMBean.showForm ? 'block' : 'none'}; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); z-index: 1000; overflow-y: auto;"
                         onclick="if(event.target === this) { hideModal(); }">
                        <div style="background: white; max-width: 550px; margin: 50px auto; border-radius: 16px; box-shadow: 0 20px 60px rgba(0,0,0,0.3); overflow: hidden;">
                            <div style="background: linear-gradient(135deg, #3f72af, #5a95cf); padding: 20px 25px; display: flex; justify-content: space-between; align-items: center;">
                                <h3 style="margin: 0; color: white;">‚ûï Add Import/Export Transaction</h3>
                                <h:commandButton value="‚úï" actionListener="#{stockTransactionsMBean.cancelForm}"
                                                style="background: rgba(255,255,255,0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 50%; cursor: pointer;">
                                    <f:ajax render="transactionFormModal" onevent="function(data){if(data.status=='success'){hideModal();}}" />
                                </h:commandButton>
                            </div>
                            
                            <div style="padding: 25px;">
                                <div style="margin-bottom: 18px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">üìã Transaction Type *</label>
                                    <h:selectOneMenu id="transactionType" value="#{stockTransactionsMBean.selected.type}" required="true"
                                                    style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ced4da;">
                                        <f:selectItem itemLabel="üì• Import" itemValue="Import" />
                                        <f:selectItem itemLabel="üì§ Export" itemValue="Export" />
                                        <f:ajax event="change" render="unitCostSection supplierSection" />
                                    </h:selectOneMenu>
                                </div>
                                
                                <div style="margin-bottom: 18px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">üì¶ Product *</label>
                                    <h:selectOneMenu id="product" value="#{stockTransactionsMBean.selectedProductId}" required="true"
                                                    style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ced4da;">
                                        <f:selectItem itemLabel="-- Select product --" itemValue="" />
                                        <f:selectItems value="#{stockTransactionsMBean.allProducts}" var="p"
                                                      itemLabel="#{p.name}" itemValue="#{p.productID}" />
                                        <f:ajax event="change" listener="#{stockTransactionsMBean.loadSelectedProduct}" render="productInfoPanel minStockSection unitCostSection supplierSection" />
                                    </h:selectOneMenu>
                                    
                                    <h:panelGroup id="productInfoPanel">
                                        <h:panelGroup rendered="#{stockTransactionsMBean.selectedProduct != null}" layout="block"
                                                     style="margin-top: 10px; padding: 12px; background: #e8f4fd; border-radius: 8px; border-left: 4px solid #3f72af;">
                                            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 8px; font-size: 13px;">
                                                <div>üìä Stock: <strong style="color: #3f72af;">#{stockTransactionsMBean.selectedProduct.quantity}</strong></div>
                                                <div>üí∞ Price: <strong style="color: #28a745;">#{stockTransactionsMBean.formatCurrency(stockTransactionsMBean.selectedProduct.unitPrice)}</strong></div>
                                                <div>üìã Status: <strong style="color: #{stockTransactionsMBean.getStockStatusColor(stockTransactionsMBean.selectedProduct)};">#{stockTransactionsMBean.getStockStatus(stockTransactionsMBean.selectedProduct)}</strong></div>
                                            </div>
                                        </h:panelGroup>
                                    </h:panelGroup>
                                </div>
                                
                                <div style="margin-bottom: 18px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">üî¢ Quantity *</label>
                                    <h:inputText id="quantity" value="#{stockTransactionsMBean.selected.quantity}" required="true"
                                                style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ced4da;">
                                        <f:validateLongRange minimum="1" />
                                    </h:inputText>
                                    <div style="font-size: 11px; color: #666; margin-top: 4px;">Import/Export quantity</div>
                                </div>
                                
                                <h:panelGroup id="minStockSection">
                                    <h:panelGroup rendered="#{stockTransactionsMBean.selectedProduct != null}">
                                        <div style="margin-bottom: 18px;">
                                            <label style="display: block; margin-bottom: 6px; font-weight: 600;">‚ö†Ô∏è Min Stock</label>
                                            <h:inputText id="minStock" value="#{stockTransactionsMBean.selectedProduct.minStock}"
                                                        pt:placeholder="Default: 10"
                                                        style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ced4da;">
                                                <f:validateLongRange minimum="0" />
                                            </h:inputText>
                                            <div style="font-size: 11px; color: #666; margin-top: 4px;">Warning when stock is below this level</div>
                                        </div>
                                    </h:panelGroup>
                                </h:panelGroup>
                                
                                <h:panelGroup id="unitCostSection">
                                    <h:panelGroup rendered="#{stockTransactionsMBean.selected.type == 'Import'}">
                                        <div style="margin-bottom: 18px;">
                                            <label style="display: block; margin-bottom: 6px; font-weight: 600;">üí∞ Unit Cost (VND)</label>
                                            <h:inputText id="unitCost" value="#{stockTransactionsMBean.selected.unitCost}"
                                                        pt:placeholder="Auto from last import"
                                                        style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ced4da;">
                                                <f:validateLongRange minimum="0" />
                                            </h:inputText>
                                        </div>
                                    </h:panelGroup>
                                </h:panelGroup>
                                
                                <h:panelGroup id="supplierSection">
                                    <h:panelGroup rendered="#{stockTransactionsMBean.selected.type == 'Import'}">
                                        <div style="margin-bottom: 18px;">
                                            <label style="display: block; margin-bottom: 6px; font-weight: 600;">üè¢ Supplier</label>
                                            <h:selectOneMenu id="supplier" value="#{stockTransactionsMBean.selectedSupplierId}"
                                                            style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ced4da;">
                                                <f:selectItem itemLabel="-- Select supplier --" itemValue="" />
                                                <f:selectItems value="#{stockTransactionsMBean.allSuppliers}" var="s"
                                                              itemLabel="#{s.supplierName}" itemValue="#{s.supplierID}" />
                                            </h:selectOneMenu>
                                        </div>
                                    </h:panelGroup>
                                </h:panelGroup>
                                
                                <div style="margin-bottom: 18px;">
                                    <label style="display: block; margin-bottom: 6px; font-weight: 600;">üìù Note</label>
                                    <h:inputTextarea id="note" value="#{stockTransactionsMBean.selected.note}" rows="2"
                                                    style="width: 100%; padding: 10px; border-radius: 8px; border: 1px solid #ced4da;" />
                                </div>
                                
                                <div style="display: flex; gap: 10px; justify-content: flex-end; margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                                    <h:commandButton value="‚ùå Cancel" actionListener="#{stockTransactionsMBean.cancelForm}"
                                                    style="background: #6c757d; border: none; padding: 10px 20px; border-radius: 8px; color: white; cursor: pointer;">
                                        <f:ajax render="transactionFormModal" onevent="function(data){if(data.status=='success'){hideModal();}}" />
                                    </h:commandButton>
                                    <h:commandButton value="üíæ Save" actionListener="#{stockTransactionsMBean.save}"
                                                    style="background: linear-gradient(135deg, #28a745, #20c997); border: none; padding: 10px 20px; border-radius: 8px; color: white; font-weight: 600; cursor: pointer;">
                                        <f:ajax execute="@form" render="transactionFormModal :stockForm :historyForm :statsForm :messages"
                                                onevent="function(data){if(data.status=='success'){hideModal();}}" />
                                    </h:commandButton>
                                </div>
                            </div>
                        </div>
                    </div>
                </h:panelGroup>
            </h:form>
            
            <script type="text/javascript">
                function showModal(id) {
                    var el = document.getElementById(id);
                    if (el) { el.style.display = 'block'; document.body.style.overflow = 'hidden'; }
                }
                function hideModal() {
                    var el = document.getElementById('transactionModalOverlay');
                    if (el) { el.style.display = 'none'; document.body.style.overflow = 'auto'; }
                }
            </script>
            
            <style>
                .table { border-collapse: collapse; width: 100%; }
                .table th, .table td { padding: 12px 15px; text-align: left; border-bottom: 1px solid #eee; }
                .table th { background: #3f72af; color: white; font-weight: 600; }
                .table tr:hover { background: #f8f9fa; }
            </style>
        </ui:define>
    </ui:composition>
</html>
