<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

    <ui:composition template="/template.xhtml">
        <ui:define name="title">üìä Admin Dashboard</ui:define>

        <ui:define name="content">
            <h:outputStylesheet library="css" name="shipper-style.css" />
            <h:messages globalOnly="true" id="messages" />
            
            <div class="shipper-page">
                    
                    <!-- Check login and admin role -->
                    <h:panelGroup rendered="#{loginMBean.currentUser == null or !loginMBean.isAdmin()}">
                        <div class="empty-state" style="padding: 80px 20px;">
                            <div class="empty-state-icon">üîê</div>
                            <h2 class="empty-state-title">Truy c·∫≠p b·ªã t·ª´ ch·ªëi</h2>
                            <p class="empty-state-desc">Please login with Admin account to access</p>
                            <h:link outcome="login" styleClass="btn btn-primary btn-lg" style="margin-top: 24px;">
                                üîì ƒêƒÉng nh·∫≠p
                            </h:link>
                        </div>
                    </h:panelGroup>
                    
                    <!-- Dashboard Content -->
                    <h:panelGroup rendered="#{loginMBean.currentUser != null and loginMBean.isAdmin()}">
                        <h:form id="dashboardForm">
                            
                            <!-- Page Header -->
                            <div class="shipper-header">
                                <div>
                                    <h1 class="shipper-title">
                                        <span class="shipper-title-icon">üìä</span>
                                        Admin Dashboard
                                    </h1>
                                    <p class="shipper-subtitle">
                                        Xin ch√†o, <strong>#{loginMBean.currentUser.fullName != null ? loginMBean.currentUser.fullName : loginMBean.currentUser.userName}</strong>! 
                                        Th·ªëng k√™ h·ªá th·ªëng
                                    </p>
                                </div>
                                <div style="display: flex; gap: 12px;">
                                    <h:commandButton value="üîÑ L√†m m·ªõi" 
                                                   actionListener="#{adminDashboardMBean.refreshStatistics()}"
                                                   styleClass="btn btn-secondary">
                                        <f:ajax render="dashboardForm" />
                                    </h:commandButton>
                                </div>
                            </div>
                            
                            <!-- Filter Section -->
                            <div class="filter-section" style="background: white; padding: 20px; border-radius: 12px; margin-bottom: 24px; box-shadow: 0 2px 8px rgba(0,0,0,0.1);">
                                <div class="filter-row">
                                    <div class="filter-group">
                                        <span class="filter-label" style="font-weight: 600; margin-bottom: 8px; display: block;">üìÖ Filter by Month/Year</span>
                                        <div style="display: flex; gap: 12px; align-items: center;">
                                            <h:selectOneMenu value="#{adminDashboardMBean.selectedMonth}" styleClass="form-control form-select" style="min-width: 140px;">
                                                <f:selectItem itemValue="1" itemLabel="January" />
                                                <f:selectItem itemValue="2" itemLabel="February" />
                                                <f:selectItem itemValue="3" itemLabel="March" />
                                                <f:selectItem itemValue="4" itemLabel="April" />
                                                <f:selectItem itemValue="5" itemLabel="May" />
                                                <f:selectItem itemValue="6" itemLabel="June" />
                                                <f:selectItem itemValue="7" itemLabel="July" />
                                                <f:selectItem itemValue="8" itemLabel="August" />
                                                <f:selectItem itemValue="9" itemLabel="September" />
                                                <f:selectItem itemValue="10" itemLabel="October" />
                                                <f:selectItem itemValue="11" itemLabel="November" />
                                                <f:selectItem itemValue="12" itemLabel="December" />
                                                <f:ajax event="change" listener="#{adminDashboardMBean.applyFilter()}" render="dashboardForm" />
                                            </h:selectOneMenu>
                                            
                                            <h:inputText value="#{adminDashboardMBean.selectedYear}" 
                                                       styleClass="form-control" 
                                                       style="min-width: 100px;">
                                                <f:passThroughAttribute name="type" value="number" />
                                                <f:passThroughAttribute name="placeholder" value="Year" />
                                                <f:ajax event="blur" listener="#{adminDashboardMBean.applyFilter()}" render="dashboardForm" />
                                            </h:inputText>
                                            
                                            <h:commandButton value="üîç Apply" 
                                                           actionListener="#{adminDashboardMBean.applyFilter()}"
                                                           styleClass="btn btn-primary">
                                                <f:ajax render="dashboardForm" />
                                            </h:commandButton>
                                            
                                            <h:commandButton value="üîÑ Reset" 
                                                           actionListener="#{adminDashboardMBean.resetFilter()}"
                                                           styleClass="btn btn-secondary">
                                                <f:ajax render="dashboardForm" />
                                            </h:commandButton>
                                        </div>
                                        <!-- ƒêang xem th√°ng/nƒÉm ƒë√£ ch·ªçn -->
                                        <small style="color: #666; margin-top: 8px; display: block;">
                                            üìä Viewing: #{adminDashboardMBean.getMonthName(adminDashboardMBean.selectedMonth)} #{adminDashboardMBean.selectedYear}
                                        </small>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Product & Category Statistics - MOVED TO TOP -->
                            <div class="section-header" style="margin-top: 0;">
                                <h2 class="section-title">
                                    <span class="section-title-icon">üì¶</span>
                                    Product &amp; Category Statistics
                                </h2>
                            </div>
                            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); margin-bottom: 32px;">
                                <div class="stat-card" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üì¶</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Products</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.totalProducts}</div>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">All time</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); color: white;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üìÇ</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Categories</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.totalCategories}</div>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">All time</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); color: white;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üè¢</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Suppliers</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.totalSuppliers}</div>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">All time</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); color: white;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üè∑Ô∏è</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Brands</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.totalBrands}</div>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">All time</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Main Statistics Cards -->
                            <div class="stats-grid">
                                <!-- Total Orders -->
                                <div class="stat-card pending animate-slide-up" style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üìã</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Orders</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.totalOrders}</div>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">In selected month</div>
                                    </div>
                                </div>
                                
                                <!-- Total Revenue -->
                                <div class="stat-card picked animate-slide-up" style="background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); animation-delay: 0.1s;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üí∞</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Revenue</div>
                                        <div class="stat-value" style="color: white; font-size: 28px;">#{adminDashboardMBean.formatAmount(adminDashboardMBean.totalRevenue)}</div>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">In selected month</div>
                                    </div>
                                </div>
                                
                                <!-- Total Customers -->
                                <div class="stat-card shipping animate-slide-up" style="background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%); animation-delay: 0.2s;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üë•</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Customers</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.totalCustomers}</div>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">All time</div>
                                    </div>
                                </div>
                                
                                <!-- Total Shippers -->
                                <div class="stat-card delivered animate-slide-up" style="background: linear-gradient(135deg, #43e97b 0%, #38f9d7 100%); animation-delay: 0.3s;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üöö</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Total Shippers</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.totalShippers}</div>
                                        <div style="font-size: 12px; opacity: 0.9; margin-top: 4px;">All time</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Order Status Statistics -->
                            <div class="section-header" style="margin-top: 32px;">
                                <h2 class="section-title">
                                    <span class="section-title-icon">üìä</span>
                                    Order Status Statistics
                                </h2>
                            </div>
                            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                                <div class="stat-card" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">‚è≥ Pending</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.pendingOrders}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #0d6efd 0%, #0056b3 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">‚öôÔ∏è Processing</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.processingOrders}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #0dcaf0 0%, #0aa2c0 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">üöö Shipping</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.shippingOrders}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #198754 0%, #146c43 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">‚úÖ Completed</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.completedOrders}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #dc3545 0%, #bb2d3b 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">‚ùå Cancelled</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.cancelledOrders}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Delivery Status Statistics -->
                            <div class="section-header" style="margin-top: 32px;">
                                <h2 class="section-title">
                                    <span class="section-title-icon">üöö</span>
                                    Delivery Status Statistics
                                </h2>
                            </div>
                            <div class="stats-grid" style="grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));">
                                <div class="stat-card" style="background: linear-gradient(135deg, #ffc107 0%, #ff9800 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">‚è≥ Pending</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.pendingDeliveries}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #0dcaf0 0%, #0aa2c0 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">üöö Shipping</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.shippingDeliveries}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #198754 0%, #146c43 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">‚úÖ Delivered</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.deliveredDeliveries}</div>
                                    </div>
                                </div>
                                
                                <div class="stat-card" style="background: linear-gradient(135deg, #dc3545 0%, #bb2d3b 100%); color: white;">
                                    <div class="stat-content">
                                        <div class="stat-label" style="color: white;">‚ùå Failed</div>
                                        <div class="stat-value" style="color: white;">#{adminDashboardMBean.failedDeliveries}</div>
                                    </div>
                                </div>
                            </div>
                            
                            <!-- Top Products -->
                            <div class="section-header" style="margin-top: 32px;">
                                <h2 class="section-title">
                                    <span class="section-title-icon">üèÜ</span>
                                    Top 10 Best Selling Products
                                </h2>
                            </div>
                            <div class="orders-container">
                                <h:dataTable value="#{adminDashboardMBean.topProducts}" var="product" 
                                           styleClass="shipper-table"
                                           rendered="#{not empty adminDashboardMBean.topProducts}">
                                    <h:column>
                                        <f:facet name="header">#</f:facet>
                                        <strong>#{adminDashboardMBean.topProducts.indexOf(product) + 1}</strong>
                                    </h:column>
                                    
                                    <h:column>
                                        <f:facet name="header">Product</f:facet>
                                        <strong>#{product.product.name}</strong>
                                    </h:column>
                                    
                                    <h:column>
                                        <f:facet name="header">Quantity Sold</f:facet>
                                        <span class="badge" style="background: var(--shipper-primary); color: white; padding: 6px 12px;">
                                            #{product.quantity}
                                        </span>
                                    </h:column>
                                    
                                    <h:column>
                                        <f:facet name="header">Revenue</f:facet>
                                        <strong style="color: var(--shipper-success);">
                                            #{adminDashboardMBean.formatAmount(product.revenue)}
                                        </strong>
                                    </h:column>
                                </h:dataTable>
                                
                                <h:panelGroup rendered="#{empty adminDashboardMBean.topProducts}">
                                    <div class="empty-state">
                                        <div class="empty-state-icon">üì¶</div>
                                        <h3 class="empty-state-title">Ch∆∞a c√≥ d·ªØ li·ªáu</h3>
                                        <p class="empty-state-desc">No products sold this month</p>
                                    </div>
                                </h:panelGroup>
                            </div>
                            
                        </h:form>
                    </h:panelGroup>
            </div>
        </ui:define>
    </ui:composition>
</html>
