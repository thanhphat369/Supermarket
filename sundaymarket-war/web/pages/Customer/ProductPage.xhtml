<ui:composition template="/templates/layoutCustomer.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core">

    <ui:define name="content">

        <!-- ĐÃ XÓA BREADCRUMB - Chỉ giữ lại phần container chính -->
        
        <div class="container-fluid fruite py-5">
            <div class="container py-5" style="padding-top: 0 !important;">
                <div class="row g-4" style="margin-top: 0 !important;">
                    <!-- Left Sidebar - STICKY -->
                    <div class="col-lg-3">
                        <div class="sticky-sidebar">
                            <div class="mb-3">
                                <h4 class="mb-4">Danh mục sản phẩm</h4>
                                <ul class="list-unstyled fruite-categorie category-menu">
                                    <li>
                                        <h:commandLink action="#{customerProductMBean.clearFilter()}" styleClass="category-link" style="display: block; padding: 10px; text-decoration: none; color: inherit;">
                                            <span><i class="fas fa-th me-2"></i> Tất cả</span>
                                        </h:commandLink>
                                    </li>
                                    <ui:repeat value="#{customerProductMBean.allCategories}" var="category">
                                        <li>
                                            <h:commandLink action="#{customerProductMBean.filterByCategory(category.categoryID)}" styleClass="category-link" style="display: block; padding: 10px; text-decoration: none; color: inherit;">
                                                <span><i class="fas fa-tag me-2"></i> #{category.categoryName}</span>
                                            </h:commandLink>
                                        </li>
                                    </ui:repeat>
                                </ul>
                            </div>
                        </div>
                    </div>

                    <!-- Main Content - SCROLLABLE -->
                    <div class="col-lg-9 ps-4">
                        <!-- TOP CATEGORY LIKE BÁCH HÓA XANH -->
                        <div class="bhx-top-category container-fluid bg-white p-3 border rounded">
                            <div class="d-flex align-items-center overflow-auto gap-3">
                                <h:commandLink action="#{customerProductMBean.clearFilter()}" styleClass="bhx-cat-item #{empty customerProductMBean.selectedCategoryId ? 'active' : ''}" style="text-decoration: none; color: inherit;">
                                    <span>Tất cả</span>
                                </h:commandLink>
                                <ui:repeat value="#{customerProductMBean.allCategories}" var="category">
                                    <h:commandLink action="#{customerProductMBean.filterByCategory(category.categoryID)}" styleClass="bhx-cat-item #{customerProductMBean.selectedCategoryId eq category.categoryID ? 'active' : ''}" style="text-decoration: none; color: inherit;">
                                        <span>#{category.categoryName}</span>
                                    </h:commandLink>
                                </ui:repeat>
                            </div>
                        </div>


                        <!-- Products Grid - SCROLLABLE CONTENT -->
                        <div class="row g-4 justify-content-center mt-3">
                            <ui:repeat value="#{customerProductMBean.products}" var="product">
                                <div class="col-md-6 col-lg-4">
                                    <div class="border rounded position-relative">
                                        <div class="position-absolute top-0 start-0 m-2">
                                            <h:panelGroup rendered="#{product.brandID ne null}">
                                                <span class="badge bg-info">#{product.brandID.brandName}</span>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{customerProductMBean.getStock(product) gt 0 and customerProductMBean.getStock(product) lt 10}">
                                                <span class="badge bg-danger">HOT</span>
                                            </h:panelGroup>
                                        </div>
                                        <h:panelGroup rendered="#{customerProductMBean.getImageUrl(product) ne null}">
                                            <img src="#{customerProductMBean.getImageUrl(product)}" 
                                                 class="img-fluid w-100" 
                                                 alt="#{product.name}" 
                                                 style="height: 200px; object-fit: cover;"
                                                 onerror="this.src='#{facesContext.externalContext.requestContextPath}/resources/Customer/img/no-image.jpg'"/>
                                        </h:panelGroup>
                                        <h:panelGroup rendered="#{customerProductMBean.getImageUrl(product) eq null}">
                                            <img src="#{facesContext.externalContext.requestContextPath}/resources/Customer/img/no-image.jpg" 
                                                 class="img-fluid w-100" 
                                                 alt="#{product.name}" 
                                                 style="height: 200px; object-fit: cover;"/>
                                        </h:panelGroup>
                                        <div class="p-3">
                                            <h6 class="mb-2">#{product.name}</h6>
                                            <div class="d-flex align-items-baseline mb-2">
                                                <h5 class="text-danger fw-bold mb-0 me-2">#{customerProductMBean.formatPrice(product.unitPrice)}</h5>
                                            </div>
                                            <h:panelGroup rendered="#{product.description ne null and not empty product.description}">
                                                <p class="text-muted small mb-2">#{product.description}</p>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{product.categoryID ne null}">
                                                <p class="text-muted small mb-2">
                                                    <i class="fas fa-tag"></i> #{product.categoryID.categoryName}
                                                </p>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{customerProductMBean.isInStock(product)}">
                                                <p class="text-success small mb-2">
                                                    <i class="fas fa-check-circle"></i> Còn hàng (#{customerProductMBean.getStock(product)} sản phẩm)
                                                </p>
                                            </h:panelGroup>
                                            <h:panelGroup rendered="#{not customerProductMBean.isInStock(product)}">
                                                <p class="text-danger small mb-2">
                                                    <i class="fas fa-times-circle"></i> Hết hàng
                                                </p>
                                            </h:panelGroup>
                                            <h:commandButton value="MUA" 
                                                           styleClass="btn btn-success w-100"
                                                           action="#{shoppingCartMBean.addToCart(product)}"
                                                           disabled="#{not customerProductMBean.isInStock(product)}"/>
                                        </div>
                                    </div>
                                </div>
                            </ui:repeat>
                            
                            <!-- Empty state -->
                            <h:panelGroup rendered="#{empty customerProductMBean.products}">
                                <div class="col-12 text-center py-5">
                                    <p class="text-muted">Không tìm thấy sản phẩm nào.</p>
                                </div>
                            </h:panelGroup>
                        </div>
                    </div>
                </div>
            </div>
        </div>

    </ui:define>
</ui:composition>