<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="jakarta.faces.html"
      xmlns:f="jakarta.faces.core"
      xmlns:ui="jakarta.faces.facelets">

    <ui:composition template="/template.xhtml">
        <ui:define name="title">Dashboard - Shipper</ui:define>

        <ui:define name="content">
            <h:outputStylesheet library="css" name="shipper-style.css" />
            <h:messages globalOnly="true" id="messages" />
            
            <div class="shipper-page">
                    
                    <!-- Check login -->
                    <h:panelGroup rendered="#{loginMBean.currentUser == null or !loginMBean.isShipper()}">
                        <div class="empty-state" style="padding: 80px 20px;">
                            <div class="empty-state-icon">üöö</div>
                            <h2 class="empty-state-title">Shipper Dashboard</h2>
                            <p class="empty-state-desc">Vui l√≤ng ƒëƒÉng nh·∫≠p v·ªõi t√†i kho·∫£n Shipper ƒë·ªÉ truy c·∫≠p</p>
                            <h:link outcome="login" styleClass="btn btn-primary btn-lg" style="margin-top: 24px;">
                                üîì ƒêƒÉng nh·∫≠p
                            </h:link>
                        </div>
                    </h:panelGroup>
                    
                    <!-- Dashboard Content -->
                    <h:panelGroup rendered="#{loginMBean.currentUser != null and loginMBean.isShipper()}">
                        <h:form id="dashboardForm">
                            
                            <!-- Page Header -->
                            <div class="shipper-header">
                                <div>
                                    <h1 class="shipper-title">
                                        <span class="shipper-title-icon">üöö</span>
                                        Dashboard
                                    </h1>
                                    <p class="shipper-subtitle">
                                        Xin ch√†o, <strong>#{loginMBean.currentUser.fullName != null ? loginMBean.currentUser.fullName : loginMBean.currentUser.userName}</strong>! 
                                        Ch√∫c b·∫°n m·ªôt ng√†y l√†m vi·ªác hi·ªáu qu·∫£ üéØ
                                    </p>
                                </div>
                                <div style="display: flex; gap: 12px;">
                                    <h:commandButton value="üîÑ L√†m m·ªõi" 
                                                   actionListener="#{shipperDashboardMBean.refreshStatistics()}"
                                                   styleClass="btn btn-secondary">
                                        <f:ajax render="dashboardForm" />
                                    </h:commandButton>
                                </div>
                            </div>
                            
                            <!-- Statistics Cards -->
                            <div class="stats-grid">
                                <!-- ƒê∆°n ch·ªù nh·∫≠n -->
                                <div class="stat-card pending animate-slide-up">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">‚è≥</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">ƒê∆°n ch·ªù nh·∫≠n</div>
                                        <div class="stat-value">#{shipperDashboardMBean.pendingCount}</div>
                                    </div>
                                    <h:link outcome="shipperdelivery" styleClass="stat-btn">Xem ƒë∆°n ‚Üí</h:link>
                                </div>
                                
                                <!-- ƒê∆°n ƒë√£ nh·∫≠n -->
                                <div class="stat-card picked animate-slide-up" style="animation-delay: 0.1s;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üì¶</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">ƒê∆°n ƒë√£ l·∫•y</div>
                                        <div class="stat-value">#{shipperDashboardMBean.pickedUpCount}</div>
                                    </div>
                                    <h:link outcome="shipperdelivery" styleClass="stat-btn">View Orders ‚Üí</h:link>
                                </div>
                                
                                <!-- ƒêang giao h√†ng -->
                                <div class="stat-card shipping animate-slide-up" style="animation-delay: 0.2s;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">üö¥</div>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Shipping</div>
                                        <div class="stat-value">#{shipperDashboardMBean.shippingCount}</div>
                                    </div>
                                    <h:link outcome="shipperdelivery" styleClass="stat-btn">View Orders ‚Üí</h:link>
                                </div>
                                
                                <!-- ƒê√£ ho√†n th√†nh giao h√†ng -->
                                <div class="stat-card delivered animate-slide-up" style="animation-delay: 0.3s;">
                                    <div class="stat-card-header">
                                        <div class="stat-icon">‚úÖ</div>
                                        <span class="stat-trend up">‚Üó #{shipperDashboardMBean.todayDeliveredCount} today</span>
                                    </div>
                                    <div class="stat-content">
                                        <div class="stat-label">Completed</div>
                                        <div class="stat-value">#{shipperDashboardMBean.deliveredCount}</div>
                                    </div>
                                    <h:link outcome="deliveryhistory" styleClass="stat-btn">History ‚Üí</h:link>
                                </div>
                            </div>
                            
                            <!-- Quick Actions -->
                            <!-- C√°c thao t√°c nhanh -->
                            <div class="section-header">
                                <h2 class="section-title">
                                    <span class="section-title-icon">‚ö°</span>
                                    Quick Actions
                                </h2>
                            </div>
                            <div class="quick-actions">
                                <h:link outcome="shipperdelivery" styleClass="quick-action-btn qa-primary">
                                    üìã Manage Orders
                                </h:link>
                                <h:link outcome="deliveryhistory" styleClass="quick-action-btn qa-primary" style="background: linear-gradient(135deg, #3f72af, #2b5c8a);">
                                    üìú Delivery History
                                </h:link>
                                <h:link outcome="shipper-finance" styleClass="quick-action-btn qa-warning">
                                    üí∞ Finance &amp; COD
                                </h:link>
                                <h:link outcome="profiledetail" styleClass="quick-action-btn qa-secondary">
                                    üë§ Profile
                                </h:link>
                            </div>
                            
                            <!-- Contact Cards -->
                            <!-- Li√™n h·ªá nhanh -->
                            <div class="section-header">
                                <h2 class="section-title">
                                    <span class="section-title-icon">üí¨</span>
                                    Quick Contact
                                </h2>
                                <a href="#" class="section-link">View All ‚Üí</a>
                            </div>
                            <div class="contact-grid">
                                <div class="contact-card admin">
                                    <div class="contact-icon">üëë</div>
                                    <div class="contact-label">Admin</div>
                                    <div class="contact-title">Support</div>
                                    <a href="#" class="contact-btn">Chat Now</a>
                                </div>
                                
                                <div class="contact-card warehouse">
                                    <div class="contact-icon">üè≠</div>
                                    <div class="contact-label">Warehouse</div>
                                    <div class="contact-title">Pick Up</div>
                                    <a href="#" class="contact-btn">Chat Now</a>
                                </div>
                                
                                <div class="contact-card notify">
                                    <div class="contact-icon">üîî</div>
                                    <div class="contact-label">Notifications</div>
                                    <div class="contact-value">0</div>
                                    <a href="#" class="contact-btn">View Notifications</a>
                                </div>
                                
                                <div class="contact-card messages">
                                    <div class="contact-icon">üí¨</div>
                                    <div class="contact-label">Unread Messages</div>
                                    <div class="contact-value">0</div>
                                    <a href="#" class="contact-btn">View Messages</a>
                                </div>
                            </div>
                            
                            <!-- Recent Orders -->
                            <!-- ƒê∆°n h√†ng m·ªõi nh·∫•t c·∫ßn x·ª≠ l√Ω -->
                            <div class="section-header">
                                <h2 class="section-title">
                                    <span class="section-title-icon">üìã</span>
                                    Latest Orders to Process
                                </h2>
                                <h:link outcome="shipperdelivery" styleClass="section-link">View All ‚Üí</h:link>
                            </div>
                            <div class="orders-container">
                                <h:panelGroup rendered="#{empty shipperDashboardMBean.pendingDeliveries}">
                                    <div class="empty-state">
                                        <div class="empty-state-icon">üì≠</div>
                                        <h3 class="empty-state-title">No new orders</h3>
                                        <p class="empty-state-desc">New orders will appear here</p>
                                    </div>
                                </h:panelGroup>
                                
                                <ui:repeat value="#{shipperDashboardMBean.pendingDeliveries}" var="d" varStatus="status">
                                    <ui:fragment rendered="#{status.index lt 5}">
                                        <div class="order-item">
                                            <div class="order-avatar">üì¶</div>
                                            <div class="order-info">
                                                <div class="order-id">Order ##{d.orderID.orderID}</div>
                                                <div class="order-customer">
                                                    üë§ #{d.orderID.userID.fullName != null ? d.orderID.userID.fullName : d.orderID.userID.userName}
                                                    <span style="margin-left: 12px;">üìç #{d.orderID.userID.address != null ? d.orderID.userID.address : 'N/A'}</span>
                                                </div>
                                            </div>
                                            <div class="order-meta">
                                                <span class="order-amount">
                                                    #{shipperDashboardMBean.formatAmount(d.orderID.totalAmount)}
                                                </span>
                                                <span class="order-status pending">
                                                    #{shipperDashboardMBean.getStatusText(d.status)}
                                                </span>
                                            </div>
                                            <div class="order-actions">
                                                <h:commandButton value="üì¶ Pick Up" 
                                                               actionListener="#{shipperDashboardMBean.pickUpDelivery(d)}"
                                                               styleClass="btn btn-primary btn-sm">
                                                    <f:ajax render="dashboardForm :messages" />
                                                </h:commandButton>
                                            </div>
                                        </div>
                                    </ui:fragment>
                                </ui:repeat>
                            </div>
                            
                            <!-- Today's Summary -->
                            <!-- T·ªïng k·∫øt h√¥m nay -->
                            <div class="summary-grid">
                                <div class="summary-card today">
                                    <div class="summary-label">üìÖ Delivered Today</div>
                                    <div class="summary-value">#{shipperDashboardMBean.todayDeliveredCount}</div>
                                    <div class="summary-unit">orders</div>
                                </div>
                                
                                <div class="summary-card month">
                                    <div class="summary-label">üìÜ Delivered This Month</div>
                                    <div class="summary-value">#{shipperDashboardMBean.monthDeliveredCount}</div>
                                    <div class="summary-unit">ƒë∆°n h√†ng</div>
                                </div>
                                
                                <div class="summary-card failed">
                                    <div class="summary-label">‚ùå ƒê∆°n th·∫•t b·∫°i</div>
                                    <div class="summary-value">#{shipperDashboardMBean.failedCount}</div>
                                    <div class="summary-unit">ƒë∆°n h√†ng</div>
                                </div>
                                
                                <div class="summary-card money">
                                    <div class="summary-label">üí∞ COD ƒëang gi·ªØ</div>
                                    <div class="summary-value" style="font-size: 24px;">#{shipperFinanceMBean.formatAmount(shipperFinanceMBean.totalPendingCOD)}</div>
                                    <div class="summary-unit">c·∫ßn n·ªôp</div>
                                </div>
                            </div>
                            
                        </h:form>
                    </h:panelGroup>
            </div>
        </ui:define>
    </ui:composition>
</html>
